<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="communityMapper">

	<resultMap id="communityResultSet" type="community">
		<result column="BOARD_NO" property="boardNo"/>
		<result column="USER_NO" property="userNo"/>
		<result column="CATEGORY_NO" property="categoryNo"/>
		<result column="BOARD_TYPE" property="boardType"/>
		<result column="BOARD_TITLE" property="boardTitle"/>
		<result column="COUNT" property="count"/>
		<result column="CREATE_DATE" property="createDate"/>
		<result column="STATUS" property="status"/>
		<result column="REPORT" property="report"/>
		<result column="BOARD_CONTENT" property="boardContent"/>
		<result column="USER_ID" property="userId"/>
		<result column="CATEGORY_NAME" property="categoryName"/>
	</resultMap>
	
	<resultMap id="communityFileResultSet" type="communityFile">
		<result column="FILE_NO" property="fileNo"/>
		<result column="BOARD_NO" property="boardNo"/>
		<result column="ORIGIN_NAME" property="originName"/>
		<result column="CHANGE_NAME" property="changeName"/>
		<result column="FILE_PATH" property="filePath"/>
		<result column="FILE_LEVEL" property="fileLevel"/>	
	</resultMap>
	
	<resultMap id="categoryResultSet" type="category">
		<result column="CATEGORY_NO" property="categoryNo"/>
		<result column="CATEGORY_NAME" property="categoryName"/>
	</resultMap>
	
	
	<select id="listCount" parameterType="_int" resultType="_int">
		SELECT
			COUNT(*)
		FROM 
			COMMUNITY
		WHERE
			STATUS = 'Y'
		AND 
			BOARD_TYPE = #{boardType}
	
	</select>
	
	<select id="boardList" parameterType="_int" resultMap="communityResultSet">
		SELECT *
		FROM(
		    SELECT ROWNUM BOARD_NO, A.*
		    FROM (
		        SELECT BOARD_TITLE, USER_ID, C.COUNT, C.CREATE_DATE, BOARD_TYPE
		        FROM COMMUNITY C
		        JOIN MEMBER USING (USER_NO)
		        <choose>
		        	<when test="boardType == 0">
		        		WHERE BOARD_TYPE = 0	        	
		        	</when>
		        	<when test="boardType == 1">
		        		WHERE BOARD_TYPE = 1	
		        	</when>
		        	<when test="boardType == 2">
		        		WHERE BOARD_TYPE = 2	
		        	</when>
		        	<when test="boardType == 3">
		        		WHERE BOARD_TYPE = 3	
		        	</when>
		        
		        </choose>
		        
		        AND C.STATUS = 'Y'
		        ORDER BY CREATE_DATE ASC) A)
		        ORDER BY BOARD_NO DESC
	</select>
	
	<select id="searchNoticeCount" parameterType="hashmap" resultType="_int">		
		SELECT
			COUNT(*)
		FROM 
			COMMUNITY
		WHERE
			STATUS = 'Y'
		AND 
			BOARD_TYPE = 0
		 <choose>
		      <when test="condition == 'title'">
		        	AND BOARD_TITLE
		       </when>
		       <otherwise>
		        	AND BOARD_CONTENT
		       </otherwise>
		 </choose>
			LIKE '%' || #{keyword} || '%'
	
	</select>
	
	<select id="searchNoticeList" parameterType="hashmap" resultMap="communityResultSet">
		SELECT *
		FROM(
		    SELECT ROWNUM RNUM, A.*
		    FROM (
		        SELECT BOARD_NO, BOARD_TITLE, USER_ID, C.COUNT, C.CREATE_DATE
		        FROM COMMUNITY C
		        JOIN MEMBER USING (USER_NO)
		        WHERE BOARD_TYPE = 0
		        AND C.STATUS = 'Y'
		        
		        <choose>
		        	<when test="condition == 'title'">
		        		AND BOARD_TITLE
		        	</when>
		        	<otherwise>
		        		AND BOARD_CONTENT
		        	</otherwise>
		        </choose>
		        		LIKE '%' || #{keyword} || '%'
		        ORDER BY CREATE_DATE DESC) A)
	
	</select>
	
	<update id="increaseCount" parameterType="_int">
		UPDATE 
			COMMUNITY
		SET
			COUNT = COUNT + 1
		WHERE 
			STATUS = 'Y'
		AND
			BOARD_NO = #{boardNo}
	
	</update>
	
	<select id="boardDetail" parameterType="_int" resultMap="communityResultSet">
		SELECT
			CATEGORY_NAME,
			BOARD_TYPE,
			BOARD_TITLE, 
			USER_ID, 
			TO_CHAR(CREATE_DATE, 'YYYY-MM-DD') AS "CREATE_DATE",
			BOARD_CONTENT		 
		FROM 
			COMMUNITY C
		JOIN MEMBER USING (USER_NO)
		JOIN CATEGORY USING(CATEGORY_NO)
		WHERE 
			BOARD_NO = #{boardNo}
		AND
			C.STATUS = 'Y'
		
			
	</select>
	




</mapper>